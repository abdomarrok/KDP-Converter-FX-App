<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.collections.FXCollections?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.web.WebView?>
<?import java.lang.String?>

<BorderPane xmlns="http://javafx.com/javafx"
            xmlns:fx="http://javafx.com/fxml"
            fx:controller="com.boilerplate.app.controller.MainController"
            prefHeight="750.0" prefWidth="1200.0" styleClass="root">
  <!-- TOP: Header Bar -->
  <top>
    <HBox styleClass="header-bar" spacing="15" alignment="CENTER_LEFT">
      <padding>
        <Insets top="12" right="15" bottom="12" left="15"/>
      </padding>
      <Label text="StoryForge" styleClass="app-title"/>
      <TextField fx:id="urlField" promptText="Paste Gemini story URL here..." HBox.hgrow="ALWAYS"/>
      <Button text="Load" onAction="#handleLoadUrl" styleClass="btn-primary"/>
      <Separator orientation="VERTICAL"/>
      <ToggleButton fx:id="editModeToggle" text="âœï¸ Edit Mode" onAction="#handleToggleEditMode"/>
    </HBox>
  </top>

  <!-- CENTER: Main Content -->
  <center>
    <SplitPane fx:id="mainSplitPane" dividerPositions="0.25, 0.55">
      <items>
        <!-- LEFT PANEL: Scene List + KDP Settings -->
        <VBox spacing="0" styleClass="panel">
          <!-- Scene List Header -->
          <HBox alignment="CENTER_LEFT" spacing="10" styleClass="panel-header">
            <Label text="ðŸ“š Scenes" styleClass="panel-title"/>
            <Region HBox.hgrow="ALWAYS"/>
            <Label fx:id="sceneCountLabel" text="(0)" style="-fx-text-fill: gray;"/>
          </HBox>
          <!-- Scene List -->
          <StackPane VBox.vgrow="ALWAYS">
            <ListView fx:id="sceneListView" styleClass="scene-list"/>
            <!-- Empty State -->
            <VBox fx:id="emptyState" alignment="CENTER" spacing="10" styleClass="empty-state" visible="true">
              <Label text="ðŸ“– No scenes extracted" style="-fx-font-size: 16;"/>
              <Label text="Load a URL and click Extract" style="-fx-font-size: 12;"/>
            </VBox>
          </StackPane>
          <!-- Scene Actions -->
          <HBox spacing="5" alignment="CENTER" styleClass="panel-footer">
            <Button fx:id="moveUpBtn" text="â¬†" onAction="#handleMoveSceneUp" disable="true"/>
            <Button fx:id="moveDownBtn" text="â¬‡" onAction="#handleMoveSceneDown" disable="true"/>
            <Button fx:id="deleteSceneBtn" text="ðŸ—‘" onAction="#handleDeleteScene" disable="true"/>
            <Region HBox.hgrow="ALWAYS"/>
            <Button text="+ Add" onAction="#handleAddScene" disable="true"/>
          </HBox>
          <Separator/>
          <!-- KDP Template Settings -->
          <VBox spacing="8" styleClass="template-panel">
            <Label text="ðŸ“„ KDP Template" styleClass="panel-title"/>
            <HBox spacing="10" alignment="CENTER_LEFT">
              <Label text="Size:" minWidth="60"/>
              <ComboBox fx:id="templateCombo" maxWidth="Infinity" HBox.hgrow="ALWAYS">
                <items>
                  <FXCollections fx:factory="observableArrayList">
                    <String fx:value="Standard Paperback (6x9)"/>
                    <String fx:value="Picture Book (8.5x8.5)"/>
                    <String fx:value="Workbook (8.5x11)"/>
                    <String fx:value="Large Print (8x10)"/>
                  </FXCollections>
                </items>
              </ComboBox>
            </HBox>
            <HBox spacing="10" alignment="CENTER_LEFT">
              <Label text="Layout:" minWidth="60"/>
              <ComboBox fx:id="layoutCombo" maxWidth="Infinity" HBox.hgrow="ALWAYS">
                <items>
                  <FXCollections fx:factory="observableArrayList">
                    <String fx:value="Full Page Image"/>
                    <String fx:value="Image Top, Text Below"/>
                    <String fx:value="Sidebar Image"/>
                    <String fx:value="Text Only"/>
                  </FXCollections>
                </items>
              </ComboBox>
            </HBox>
            <HBox spacing="10" alignment="CENTER_LEFT">
              <Label text="Font:" minWidth="60"/>
              <Spinner fx:id="fontSizeSpinner" minWidth="70" maxWidth="70"/>
              <Label text="pt"/>
            </HBox>
          </VBox>
        </VBox>
        <!-- CENTER PANEL: Scene Editor (visible in Edit Mode) -->
        <VBox fx:id="editorPanel" spacing="0" styleClass="panel" visible="false" managed="false">
          <HBox alignment="CENTER_LEFT" spacing="10" styleClass="panel-header">
            <Label fx:id="editorTitleLabel" text="ðŸ“ Scene Editor" styleClass="panel-title"/>
            <Region HBox.hgrow="ALWAYS"/>
            <Label fx:id="sceneIndexLabel" text="Scene 0 of 0" style="-fx-text-fill: gray;"/>
          </HBox>
          <ScrollPane VBox.vgrow="ALWAYS" fitToWidth="true" styleClass="editor-scroll">
            <VBox spacing="15" style="-fx-padding: 15;">
              <!-- Large Image Preview -->
              <VBox alignment="CENTER" spacing="10">
                <Label text="Image Preview" style="-fx-font-weight: bold;"/>
                <StackPane styleClass="image-preview-container" minHeight="250" maxHeight="300">
                  <ImageView fx:id="editorImageView" preserveRatio="true" fitWidth="350"/>
                  <Label fx:id="noImageLabel" text="No image" style="-fx-text-fill: gray;"/>
                </StackPane>
                <Button text="ðŸ“· Replace Image" onAction="#handleReplaceImage" disable="true"/>
              </VBox>
              <Separator/>
              <!-- Text Editor -->
              <VBox spacing="5" VBox.vgrow="ALWAYS">
                <Label text="Scene Text" style="-fx-font-weight: bold;"/>
                <TextArea fx:id="sceneTextArea" wrapText="true" prefRowCount="8" 
                                                          promptText="Enter scene text here..." VBox.vgrow="ALWAYS"/>
              </VBox>
              <!-- Save Button -->
              <HBox alignment="CENTER_RIGHT">
                <Button text="ðŸ’¾ Save Changes" onAction="#handleSaveScene" styleClass="btn-success"/>
              </HBox>
            </VBox>
          </ScrollPane>
        </VBox>
        <!-- RIGHT PANEL: WebView Browser -->
        <VBox spacing="0" styleClass="panel">
          <HBox alignment="CENTER_LEFT" spacing="10" styleClass="panel-header">
            <Label text="ðŸŒ Browser" styleClass="panel-title"/>
            <Region HBox.hgrow="ALWAYS"/>
            <Button text="âŸ³" onAction="#handleRefreshBrowser" styleClass="btn-small"/>
          </HBox>
          <StackPane VBox.vgrow="ALWAYS">
            <WebView fx:id="webView"/>
          </StackPane>
        </VBox>
      </items>
    </SplitPane>
  </center>

  <!-- BOTTOM: Status Bar + Actions -->
  <bottom>
    <HBox styleClass="footer-bar" spacing="15" alignment="CENTER_LEFT">
      <padding>
        <Insets top="10" right="15" bottom="10" left="15"/>
      </padding>
      <Label fx:id="statusLabel" text="Ready to forge stories." HBox.hgrow="ALWAYS"/>
      <Button text="ðŸ“‚ Open" onAction="#handleOpenStory"/>
      <Button text="ðŸ’¾ Save" onAction="#handleSaveStory"/>
      <Separator orientation="VERTICAL"/>
      <Button fx:id="extractButton" text="ðŸ”® Extract Scenes" onAction="#handleExtract" styleClass="btn-primary"/>
      <Button text="ðŸ“„ Generate PDF" onAction="#handleGeneratePdf"/>
      <Button text="ðŸ‘ Preview PDF" onAction="#handlePreviewPdf" styleClass="btn-accent"/>
    </HBox>
  </bottom>
</BorderPane>
